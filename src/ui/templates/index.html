<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ i18n["title"] }}</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <div class="brand">
      <h1>Ultimate Trading Bot v2</h1>
      <div class="badge-row">
        <span class="mode">Mode: {{ mode|upper }}</span>
        {% if mock_mode %}
          <span class="badge warning">MOCK MODE</span>
        {% endif %}
      </div>
    </div>
    <nav>
      <a href="#dashboard">{{ i18n["nav_dashboard"] }}</a>
      <a href="#watchlist">{{ i18n["nav_watchlist"] }}</a>
      <a href="#analyze">{{ i18n["nav_analyze"] }}</a>
      <a href="#risk">{{ i18n["nav_risk"] }}</a>
      <a href="#funding">{{ i18n["nav_funding"] }}</a>
      <a href="#backtest">{{ i18n["nav_backtest"] }}</a>
      <a href="#model-center">{{ i18n["nav_model_center"] }}</a>
      <a href="#test-center">{{ i18n["nav_test_center"] }}</a>
      <a href="#logs">{{ i18n["nav_logs"] }}</a>
    </nav>
  </header>

  <main>
    <section id="dashboard" class="panel">
      <h2>{{ i18n["dashboard_title"] }}</h2>
      <div class="grid">
        <div>
          <h3>{{ i18n["quick_status_title"] }}</h3>
          <ul>
            <li>{{ i18n["default_watchlist_size"].format(count=watchlist|length) }}</li>
            <li>{{ i18n["max_open_positions"].format(count=risk.max_open_positions) }}</li>
            <li>{{ i18n["cash_buffer"].format(percent=(risk.cash_buffer * 100)|round(1)) }}</li>
          </ul>
        </div>
        <div>
          <h3>Actions</h3>
          <button type="button" id="refresh-tests">Run Test Center</button>
          <button type="button" id="start-orchestrator">Start</button>
          <button type="button" id="pause-orchestrator">Pause</button>
          <button type="button" id="stop-orchestrator">Stop</button>
        </div>
      </div>
    </section>

    <section id="watchlist" class="panel">
      <h2>{{ i18n["watchlist_title"] }}</h2>
      <p>{{ i18n["watchlist_desc"] }}</p>
      <div class="tags">
        {% for symbol in watchlist %}
          <span>{{ symbol }}</span>
        {% endfor %}
      </div>
      <div class="form-block">
        <label for="watchlist-input">Bulk Paste</label>
        <textarea id="watchlist-input" rows="4" placeholder="AAPL, MSFT, NVDA..."></textarea>
        <button type="button" id="save-watchlist">Save Watchlist</button>
        <div id="watchlist-status" class="helper-text"></div>
      </div>
    </section>

    <section id="analyze" class="panel">
      <h2>Analyze</h2>
      <p>Run price action gate, strategy ensemble, and risk filters.</p>
      <div class="form-block">
        <label for="analyze-input">Symbols to analyze (optional)</label>
        <input id="analyze-input" type="text" placeholder="AAPL MSFT NVDA" />
        <div class="button-row">
          <button type="button" id="analyze-selected">Analyze Selected</button>
          <button type="button" id="analyze-all">Analyze All</button>
        </div>
        <div id="analyze-status" class="helper-text"></div>
      </div>
    </section>

    <section id="risk" class="panel">
      <h2>{{ i18n["risk_title"] }}</h2>
      <ul>
        <li>{{ i18n["risk_per_trade"].format(percent=(risk.risk_per_trade * 100)|round(2)) }}</li>
        <li>{{ i18n["max_position_weight"].format(percent=(risk.max_position_weight * 100)|round(1)) }}</li>
        <li>{{ i18n["weekly_drawdown"].format(percent=(risk.weekly_max_drawdown * 100)|round(1)) }}</li>
      </ul>
    </section>

    <section id="funding" class="panel">
      <h2>Funding Alerts</h2>
      <p>Cash shortfall handling: swap/trim → partial entry → trade queue (TTL).</p>
      <div id="funding-alerts" class="stacked-list"></div>
    </section>

    <section id="backtest" class="panel">
      <h2>{{ i18n["backtest_title"] }}</h2>
      <p>{{ i18n["backtest_desc"] }}</p>
      <button type="button" disabled>{{ i18n["backtest_button"] }}</button>
    </section>

    <section id="model-center" class="panel">
      <h2>{{ i18n["model_center_title"] }}</h2>
      <p>{{ i18n["model_center_desc"] }}</p>
      <button type="button" disabled>{{ i18n["model_center_button"] }}</button>
    </section>

    <section id="test-center" class="panel">
      <h2>{{ i18n["test_center_title"] }}</h2>
      <p>{{ i18n["test_center_desc"] }}</p>
      <div id="test-results">{{ i18n["test_center_default"] }}</div>
    </section>

    <section id="logs" class="panel">
      <h2>Logs</h2>
      <p>Structured logs will appear here.</p>
      <div id="log-box" class="log-box">No logs yet.</div>
    </section>
  </main>

  <footer>
    <span>{{ i18n["footer"] }}</span>
  </footer>

  <script>
    window.I18N = {{ i18n | tojson }};
  </script>
  <script src="/static/app.js"></script>
</body>
</html>
